[include mainsail.cfg]
# This file contains common pin mappings for the BigTreeTech Octopus
# and Octopus Pro boards. To use this config, start by identifying the
# micro-controller on the board - it may be an STM32F446, STM32F429,
# or an STM32H723.  Select the appropriate micro-controller in "make
# menuconfig" and select "Enable low-level configuration options". For
# STM32F446 boards the firmware should be compiled with a "32KiB
# bootloader" and a "12MHz crystal" clock reference. For STM32F429
# boards use a "32KiB bootloader" and an "8MHz crystal". For STM32H723
# boards use a "128KiB bootloader" and a "25Mhz crystal".

# See docs/Config_Reference.md for a description of parameters.

## X Stepper on MOTOR0(B Motor)
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
step_pulse_duration: 0.000004 #0.000003
microsteps: 16
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: !PG6
position_min: 0
position_endstop: 740 #800
position_max: 745  # Actual maximum
homing_speed: 100   #Max 100
homing_retract_dist: 5
homing_positive_dir: true #true

[gcode_macro MOVE_Z_BEFORE_HOME]
description: Lower the bed 10mm without homing
gcode:
  G90
  SET_KINEMATIC_POSITIONZ=0
  G0 Z100 F100
  M84

# OLD  [X in MOTOR0] - B Motor
#[stepper_x]
#step_pin: PF13
#dir_pin: PF12
#enable_pin: !PF14
#microsteps: 16
#rotation_distance: 40
#step_pulse_duration: 0.000004 #0.000003
#endstop_pin: PG6
#position_endstop: 0
#position_max: 914
#homing_speed: 50

## Y Stepper on MOTOR1 (A Motor)
[stepper_y]
step_pin: PG0
dir_pin: !PG1
enable_pin: !PF15
rotation_distance: 40
step_pulse_duration: 0.000004 #0.000003
microsteps: 16
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: !PG9
position_min: 0
position_endstop: 0
position_max: 885 # Actual max is 890, -5mm for safety
homing_speed: 100  #Max 100
homing_retract_dist: 5
homing_positive_dir: false

## OLD [Y in MOTOR1] - A Motor
#[stepper_y]
#step_pin: PG0
#dir_pin: PG1
#enable_pin: !PF15
#microsteps: 16
#rotation_distance: 40
#step_pulse_duration: 0.000004 #0.000003
#endstop_pin: PG9
#position_endstop: 0
#position_max: 914
#homing_speed: 50

##	Z0 Stepper - Front Left on MOTOR2
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
microsteps: 16
rotation_distance: 1.9
#endstop_pin: PG10
#position_endstop: 0.5
endstop_pin: probe:z_virtual_endstop # BL-Touch
position_max: 500
position_min: -10
homing_speed: 25

##	Z1 Stepper - Rear Left on MOTOR3
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 1.9
microsteps: 16

## old
#[stepper_z1]
#step_pin: PG4
#dir_pin: PC1
#enable_pin: PA0
#microsteps: 16
#rotation_distance: 8
##endstop_pin: PG10
##position_endstop: 0.5
##position_max: 500


##	Z2 Stepper - Rear Right on MOTOR4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 1.9
microsteps: 16

##	Z3 Stepper - Front Right on MOTOR5
[stepper_z3]
step_pin: PC13
dir_pin: PF0
enable_pin: !PF1
rotation_distance: 1.9
microsteps: 16

##  E0 on MOTOR6
[extruder]
step_pin: PE2
dir_pin: !PE3
enable_pin: !PD4
##	Update value below when you perform extruder calibration
##	If you ask for 100mm of filament, but in reality it is 98mm:
##	rotation_distance = <previous_rotation_distance> * <actual_extrude_distance> / 100
##  22.6789511 is a good starting point
rotation_distance: 22.5343727   #old 22.6789511 #Bondtech 5mm Drive Gears
gear_ratio: 50:10				#Clockwork 2 extruder ratio is 50:10
microsteps: 16
full_steps_per_rotation: 200	#200 for 1.8 degree, 400 for 0.9 degree
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: PA2
##	Validate the following thermistor type to make sure it is correct
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF4
min_temp: 10
max_temp: 270
max_power: 1.0
min_extrude_temp: 170
control = pid
pid_kp = 20 # 26.213
pid_ki = 1.304
pid_kd = 131.721
##	Try to keep pressure_advance below 1.0
pressure_advance: 0.05
##	Default is 0.040, leave stock
pressure_advance_smooth_time: 0.040

##	E0 on MOTOR6
##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 extruder]
uart_pin: PE1
#interpolate: false
run_current: 0.5
#hold_current: 0.4
#sense_resistor: 0.110
#stealthchop_threshold: 0
#uart_address: 3

## Driver4 (OLD)
#[extruder]
#step_pin: PF9
#dir_pin: PF10
#enable_pin: !PG2
#microsteps: 16
#rotation_distance: 22.0
#nozzle_diameter: 0.400
#filament_diameter: 1.750
#gear_ratio: 50:10
#heater_pin: PA2 # HE0
#sensor_pin:  PF4 # T0
#sensor_type: ATC Semitec 104NT-4-R025H42G
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114
#min_temp: 0
#max_temp: 250

[bltouch]
sensor_pin: ^PB7   # white wire
control_pin: PB6   # yellow/green wire
x_offset: -1.184
y_offset: -44.464
#z_offset: 1

[safe_z_home]
home_xy_position: 400, 400 # Change coordinates to the center of your print bed
speed: 200
z_hop: 10                # Move up 15mm
z_hop_speed: 25

[bed_mesh]
speed: 300
horizontal_move_z: 5
mesh_min: 10, 10
mesh_max: 700, 700
probe_count: 20, 20   # number of probe points in x, y
mesh_pps: 3, 3
algorithm: bicubic
bicubic_tension: 0.2

[quad_gantry_level]
gantry_corners:
    0, 60
    740, 885
points:
    0, 60
	0, 885
	735, 885
	735, 60
max_adjust: 5.0
speed: 200
horizontal_move_z: 10

[mcu host]
serial: /tmp/klipper_host_mcu

# [adxl345]
# cs_pin: rpi:gpio8

# [resonance_tester]
# accel_chip: adxl345
# probe_points:
#   300, 300, 40
  
[gcode_macro G32]
gcode:
    QUAD_GANTRY_LEVEL
    G28
    BED_MESH_CALIBRATE


# https://www.klipper3d.org/Config_Reference.html#z_tilt
#[z_tilt]
#z_positions:
#   A list of X, Y coordinates (one per line; subsequent lines
#   indented) describing the location of each bed "pivot point". The
#   "pivot point" is the point where the bed attaches to the given Z
#   stepper. It is described using nozzle coordinates (the X, Y position
#   of the nozzle if it could move directly above the point). The
#   first entry corresponds to stepper_z, the second to stepper_z1,
#   the third to stepper_z2, etc. This parameter must be provided.
#points:
#   A list of X, Y coordinates (one per line; subsequent lines
#   indented) that should be probed during a Z_TILT_ADJUST command.
#   Specify coordinates of the nozzle and be sure the probe is above
#   the bed at the given nozzle coordinates. This parameter must be
#   provided.
#speed: 50
#   The speed (in mm/s) of non-probing moves during the calibration.
#   The default is 50.
#horizontal_move_z: 5
#   The height (in mm) that the head should be commanded to move to
#   just prior to starting a probe operation. The default is 5.
#retries: 0
#   Number of times to retry if the probed points aren't within
#   tolerance.
#retry_tolerance: 0
#   If retries are enabled then retry if largest and smallest probed
#   points differ more than retry_tolerance. Note the smallest unit of
#   change here would be a single step. However if you are probing
#   more points than steppers then you will likely have a fixed
#   minimum value for the range of probed points which you can learn
#   by observing command output.


#[filament_switch_sensor material_0]
#switch_pin: PG12


[fan]
pin: PA8

[heater_fan fan1]
pin: PE5

#[heater_fan fan2]
#pin: PD12

#[heater_fan fan3]
#pin: PD13

#[heater_fan fan4]
#pin: PD14

#[controller_fan fan5]
#pin: PD15

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_3E0040000450565843333620-if00
# CAN bus is also available on this board

[printer]
kinematics: corexy
max_velocity: 300
max_accel: 3000
max_z_velocity: 5
max_z_accel: 100

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PC5

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[neopixel my_neopixel]
#pin: PB0

[force_move]
enable_force_move: True
#   Set to true to enable FORCE_MOVE and SET_KINEMATIC_POSITION
#   extended G-Code commands. The default is false.

[pause_resume]

[display_status]

[virtual_sdcard]
path: ~/printer_data/gcodes

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bltouch]
#*# z_offset = 1.063
#*#
#*# [bed_mesh X700*Y700]
#*# version = 1
#*# points =
#*# 	0.163875, 0.095000, 0.068875, 0.016031, -0.037406, -0.095000, -0.183469, -0.225031, -0.266000, -0.304594, -0.335469, -0.394844, -0.368125, -0.315281, -0.273125, -0.199500, -0.084906, 0.072438, 0.244031, 0.454813
#*# 	0.285594, 0.216125, 0.141313, 0.093813, 0.049875, -0.008906, -0.106875, -0.179906, -0.213750, -0.245812, -0.264812, -0.314094, -0.296281, -0.291531, -0.257687, -0.210781, -0.065906, 0.061750, 0.245813, 0.429281
#*# 	0.400781, 0.327156, 0.273125, 0.155563, 0.111031, 0.046906, -0.038594, -0.102719, -0.157344, -0.190594, -0.222656, -0.260656, -0.266000, -0.214937, -0.206625, -0.154969, -0.038594, 0.132406, 0.270156, 0.462531
#*# 	0.488656, 0.390688, 0.327156, 0.188813, 0.143094, 0.087875, 0.039781, -0.024937, -0.134187, -0.137750, -0.194750, -0.197719, -0.184656, -0.207219, -0.184656, -0.098562, 0.032063, 0.163875, 0.319438, 0.495188
#*# 	0.618094, 0.470250, 0.400781, 0.307563, 0.210188, 0.135375, 0.089063, 0.048094, -0.081344, -0.068875, -0.121719, -0.154969, -0.149031, -0.133000, -0.073031, 0.003563, 0.051656, 0.201281, 0.392469, 0.520719
#*# 	0.648969, 0.506469, 0.436406, 0.358031, 0.266000, 0.186438, 0.121125, 0.048094, -0.008906, -0.058187, -0.056406, -0.100344, -0.137750, -0.102719, -0.051656, 0.054031, 0.096188, 0.261250, 0.447688, 0.597313
#*# 	0.699438, 0.554563, 0.462531, 0.381781, 0.292719, 0.203063, 0.135969, 0.086688, 0.054031, -0.011281, -0.033844, -0.014250, -0.055219, -0.047500, 0.042750, 0.064719, 0.097969, 0.324188, 0.436406, 0.624625
#*# 	0.725563, 0.551000, 0.486875, 0.373469, 0.304000, 0.213750, 0.143094, 0.093219, 0.021969, 0.011875, -0.011281, -0.013062, -0.036812, -0.008312, 0.035625, 0.081344, 0.176344, 0.347344, 0.472031, 0.660844
#*# 	0.723781, 0.530813, 0.458375, 0.388906, 0.263625, 0.187031, 0.124688, 0.078375, 0.068281, 0.004750, 0.028500, -0.007719, -0.004750, 0.029094, 0.061750, 0.087281, 0.118750, 0.190594, 0.318844, 0.425719
#*# 	0.686969, 0.513594, 0.412063, 0.349125, 0.197719, 0.165656, 0.108063, 0.064125, -0.013656, -0.002969, -0.008312, -0.040375, -0.051062, -0.014250, 0.054625, 0.095594, 0.165063, 0.253531, 0.406719, 0.475000
#*# 	0.632938, 0.474406, 0.395438, 0.274906, 0.179906, 0.109250, 0.079563, 0.026719, -0.019594, -0.037406, -0.024344, -0.063531, -0.043344, 0.001188, 0.058188, 0.069469, 0.111625, 0.244625, 0.336063, 0.469063
#*# 	0.570594, 0.439375, 0.322406, 0.167438, 0.102719, 0.055219, 0.022563, -0.038000, -0.084312, -0.079562, -0.060562, -0.096187, -0.100937, -0.051656, 0.014250, 0.064125, 0.106281, 0.281438, 0.361594, 0.506469
#*# 	0.511219, 0.394250, 0.290938, 0.134188, 0.071250, 0.017219, -0.086687, -0.119344, -0.140719, -0.097969, -0.106875, -0.114000, -0.112219, -0.065312, -0.004750, 0.057594, 0.115781, 0.223844, 0.380594, 0.502313
#*# 	0.489250, 0.363375, 0.193563, 0.092625, -0.005937, -0.049875, -0.130625, -0.185844, -0.194156, -0.179906, -0.160906, -0.155562, -0.148437, -0.119344, -0.061156, 0.054031, 0.109844, 0.208406, 0.377625, 0.555156
#*# 	0.456000, 0.336063, 0.170406, 0.057594, -0.052844, -0.109844, -0.184656, -0.204844, -0.207812, -0.212562, -0.175156, -0.157344, -0.171594, -0.110437, -0.012469, 0.054625, 0.115781, 0.241063, 0.384156, 0.578906
#*# 	0.454813, 0.314094, 0.127656, 0.040969, -0.026125, -0.127062, -0.191781, -0.216719, -0.240469, -0.255312, -0.216719, -0.213156, -0.181094, -0.104500, -0.028500, 0.050469, 0.141313, 0.270750, 0.418594, 0.616313
#*# 	0.495781, 0.377031, 0.190000, 0.083125, 0.009500, -0.040375, -0.124094, -0.191781, -0.183469, -0.160312, -0.078969, -0.012469, 0.020188, 0.048094, 0.054031, 0.120531, 0.200688, 0.346156, 0.491625, 0.670938
#*# 	0.596125, 0.432844, 0.265406, 0.158531, 0.048688, -0.017812, -0.099156, -0.170406, -0.182281, -0.204844, -0.157937, -0.127656, -0.057594, 0.008906, 0.096188, 0.163875, 0.298656, 0.438781, 0.592563, 0.762969
#*# 	0.737438, 0.542688, 0.389500, 0.245813, 0.134188, 0.057594, -0.023750, -0.109844, -0.141312, -0.092031, -0.065312, -0.021375, 0.026719, 0.095594, 0.191188, 0.307563, 0.409094, 0.510031, 0.689344, 0.834813
#*# 	0.862125, 0.704188, 0.499344, 0.355063, 0.187031, 0.112813, 0.038000, -0.023750, -0.020187, -0.029094, -0.005937, 0.038000, 0.076000, 0.165063, 0.279063, 0.367531, 0.492219, 0.660250, 0.784344, 0.973750
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 699.8900000000001
#*# min_y = 10.0
#*# max_y = 699.8899999999999
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  1.157813, 1.025406, 0.931594, 0.848469, 0.743375, 0.667969, 0.643625, 0.548031, 0.458969, 0.420969, 0.376438, 0.340219, 0.306375, 0.294500, 0.380594, 0.420375, 0.528438, 0.665000, 0.768906, 0.986813
#*# 	  1.088938, 0.948813, 0.872813, 0.774250, 0.705375, 0.645406, 0.584844, 0.477969, 0.405531, 0.342594, 0.250563, 0.244625, 0.188219, 0.214938, 0.256500, 0.331313, 0.403156, 0.563469, 0.704188, 0.869844
#*# 	  1.075875, 0.948813, 0.856781, 0.755844, 0.693500, 0.615719, 0.553375, 0.441750, 0.365156, 0.304594, 0.248781, 0.233938, 0.211969, 0.240469, 0.270750, 0.324188, 0.396625, 0.552188, 0.684594, 0.876969
#*# 	  1.062813, 0.946438, 0.790875, 0.719031, 0.669156, 0.583656, 0.506469, 0.415031, 0.333094, 0.249969, 0.208406, 0.186438, 0.201281, 0.194156, 0.250563, 0.342594, 0.422156, 0.552188, 0.693500, 0.831250
#*# 	  1.056875, 0.944063, 0.805719, 0.719031, 0.656094, 0.599688, 0.486875, 0.382969, 0.301031, 0.286781, 0.248188, 0.193563, 0.203656, 0.238688, 0.283813, 0.344375, 0.400781, 0.588406, 0.722000, 0.831844
#*# 	  1.034906, 0.901313, 0.766531, 0.684594, 0.597313, 0.517750, 0.409688, 0.357438, 0.323000, 0.254125, 0.230375, 0.199500, 0.166250, 0.196531, 0.263625, 0.330125, 0.409688, 0.552188, 0.695875, 0.825906
#*# 	  0.996313, 0.832438, 0.749906, 0.641250, 0.559313, 0.468469, 0.396031, 0.339625, 0.275500, 0.197719, 0.192375, 0.166250, 0.158531, 0.206031, 0.283813, 0.341406, 0.387719, 0.539125, 0.676875, 0.822938
#*# 	  0.906656, 0.748125, 0.681625, 0.568813, 0.417406, 0.379406, 0.321219, 0.245813, 0.177531, 0.129438, 0.213750, 0.087875, 0.128250, 0.175750, 0.206031, 0.292719, 0.346750, 0.509438, 0.608594, 0.787313
#*# 	  0.782563, 0.686375, 0.591969, 0.464313, 0.358031, 0.282031, 0.231563, 0.154969, 0.085500, 0.049281, 0.051656, 0.036813, 0.063531, 0.128250, 0.214938, 0.247594, 0.323594, 0.394844, 0.535563, 0.705969
#*# 	  0.719625, 0.567031, 0.407906, 0.346156, 0.240469, 0.192969, 0.083719, 0.027313, 0.001188, -0.022562, -0.020187, -0.008312, -0.013062, 0.023156, 0.057594, 0.131813, 0.228594, 0.334875, 0.486281, 0.635906
#*# 	  0.612156, 0.414438, 0.302219, 0.201281, 0.086094, 0.033844, -0.025531, -0.047500, -0.081937, -0.094406, -0.070656, -0.081937, -0.055812, -0.005344, 0.029688, 0.043938, 0.149625, 0.239281, 0.304000, 0.453031
#*# 	  0.423938, 0.265406, 0.125875, 0.030281, -0.049875, -0.105687, -0.159125, -0.245812, -0.261250, -0.252344, -0.228594, -0.245812, -0.214344, -0.159125, -0.074219, -0.051656, 0.042750, 0.186438, 0.295094, 0.378219
#*# 	  0.282625, 0.146063, -0.002969, -0.064719, -0.230375, -0.272531, -0.314687, -0.366937, -0.369312, -0.337250, -0.322406, -0.311719, -0.258875, -0.223844, -0.200094, -0.091437, -0.022562, 0.048094, 0.225031, 0.357438
#*# 	  0.109844, -0.020781, -0.159125, -0.271937, -0.334875, -0.365750, -0.435219, -0.475000, -0.504094, -0.463125, -0.405531, -0.419781, -0.374062, -0.334875, -0.262437, -0.202469, -0.065906, 0.047500, 0.207219, 0.395438
#*# 	  0.040375, -0.106875, -0.271937, -0.363375, -0.423344, -0.511219, -0.561094, -0.593750, -0.609781, -0.587812, -0.553375, -0.526656, -0.451844, -0.388312, -0.322406, -0.264219, -0.112219, -0.019000, 0.154969, 0.355063
#*# 	  -0.032656, -0.221469, -0.328937, -0.428687, -0.484500, -0.568812, -0.650750, -0.669156, -0.685187, -0.651344, -0.628187, -0.591375, -0.496375, -0.420375, -0.347937, -0.288562, -0.141906, -0.005937, 0.179313, 0.396625
#*# 	  -0.008312, -0.230375, -0.347344, -0.421562, -0.541500, -0.599687, -0.676281, -0.703594, -0.711906, -0.685187, -0.652531, -0.603844, -0.553969, -0.431656, -0.321812, -0.273719, -0.107469, 0.033844, 0.221469, 0.390688
#*# 	  -0.015437, -0.222656, -0.351500, -0.461937, -0.561687, -0.653719, -0.667375, -0.728531, -0.728531, -0.716062, -0.673312, -0.649562, -0.540312, -0.429875, -0.372281, -0.234531, -0.081344, 0.070063, 0.223844, 0.393656
#*# 	  0.016625, -0.121125, -0.315875, -0.419187, -0.582469, -0.642437, -0.667969, -0.707750, -0.727344, -0.709531, -0.672719, -0.624031, -0.526656, -0.403750, -0.320031, -0.212562, -0.024344, 0.122313, 0.279063, 0.463125
#*# 	  0.116969, -0.068281, -0.293312, -0.420375, -0.540906, -0.606812, -0.686375, -0.721406, -0.730906, -0.697656, -0.667969, -0.609187, -0.499344, -0.394844, -0.295687, -0.156750, -0.011281, 0.211375, 0.321813, 0.507656
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 699.8900000000001
#*# min_y = 10.0
#*# max_y = 699.8899999999999
